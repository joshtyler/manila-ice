VERILATOR = verilator
VERILATOR_FLAGS = --trace --cc --exe --l2-name v -CFLAGS '-Wall -Wextra -g -I../../hdl_common/sim'

VERILOG_TOP = top
VERILOG_SOURCES = src/top.sv \
tb/pll_model.sv \
../hdl_common/synth/other/reset_gen.sv \
../hdl_common/synth/other/fifo.sv \
../hdl_common/synth/axis/axis_fifo.sv \
../hdl_common/synth/axis/axis_register.sv \
../hdl_common/synth/axis/axis_spi_bridge.sv \
../hdl_common/synth/other/uart_rx.sv \
../hdl_common/synth/other/uart_tx.sv \
../hdl_common/synth/other/logic_cross_clock.sv \
../hdl_common/synth/wishbone/wishbone.sv \
../hdl_common/synth/wishbone/serial_wb_master.sv \
../hdl_common/synth/wishbone/simple_wb_slave.sv \
../hdl_common/synth/wishbone/wb_to_spi_master.sv \
../hdl_common/synth/wishbone/wb_axis_bridge.sv \
../hdl_common/synth/wishbone/wb_interconnect.sv

CPP_SOURCES = tb/test_bootstrap.cpp

default : run

run:
	$(VERILATOR) $(VERILATOR_FLAGS) $(VERILOG_SOURCES) --top-module $(VERILOG_TOP) $(CPP_SOURCES)

	$(MAKE) -j 4 -C obj_dir -f Vtop.mk

clean:
	rm -r obj_dir
