VERILATOR = verilator
VERILATOR_FLAGS = --trace --cc --exe --l2-name v -CFLAGS '-Wall -Wextra -g -I../../hdl_common/sim'

VERILOG_TOP = loopback_test
VERILOG_SOURCES = src/loopback_test.sv \
../hdl_common/synth/other/reset_gen.sv \
../hdl_common/synth/other/fifo.sv \
../hdl_common/synth/axis/axis_fifo.sv \
../hdl_common/synth/axis/axis_register.sv \
../hdl_common/synth/other/uart_rx.sv \
../hdl_common/synth/other/uart_tx.sv \
../hdl_common/synth/other/logic_cross_clock.sv

CPP_SOURCES = tb/test_loopback_test.cpp

default : run

run:
	$(VERILATOR) $(VERILATOR_FLAGS) $(VERILOG_SOURCES) --top-module $(VERILOG_TOP) $(CPP_SOURCES)

	$(MAKE) -j 4 -C obj_dir -f Vloopback_test.mk

clean:
	rm -r obj_dir
